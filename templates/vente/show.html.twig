{% extends 'components/layout/default.html.twig' %}
{% block content %}
<div class="panel">
    <div class="flex justify-between mb-3">
        <h2>
            Details de la facture No {{ vente.numeroVente }} Par {{ vente.createdBy }} le {{ vente.createdAt ? vente.createdAt|date('d-m-Y H:i:s') : '' }}

        </h2>
        <h2>
            Status :
            {% if(vente.statusVente == "progress") %}
                <span class="text-primary">{{ vente.statusVente | upper }}</span>

            {% elseif(vente.statusVente == "paid") %}
                <span class="text-success">{{ vente.statusVente | upper }}</span>

            {% elseif(vente.statusVente == "canceled") %}
                <span class="text-danger">{{ vente.statusVente | upper }}</span>

            {% endif %}
        </h2>
    </div>
    <div>
        <table class="table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Produit</th>
                    <th>Prix</th>
                    <th>Quantite</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
            {% set counter = 0 %}
            {% set total = 0 %}
           {% for produit in produits %}
               {% set counter = counter+1 %}
               {% set total = total + (produit.qty * produit.prixUnitaire) %}
               <tr>
                   <td>{{ counter }}</td>
                   <td>{{ produit.produit.designation }}</td>
                   <td>{{ produit.prixUnitaire }}</td>
                   <td>{{ produit.qty }}</td>
                   <td>{{ produit.qty * produit.produit.prix }}</td>
               </tr>
            {% endfor %}
            </tbody>
        </table>
        <hr>
        <span>Total : {{ total }}</span>
        <hr>
{#        <a href="{{ path('app_vente_index') }}">back to list</a>#}


        {#        {{ include('vente/_delete_form.html.twig') }}#}

    </div>
    <div class="flex justify-items-center mt-3">
        <a target="_blank" href="{{ path('app_generate_pdf', {'id': vente.id}) }}" class="btn btn-success mr-2">Imprimer</a>
{#        <a href="{{ path('app_generate_pdf', {'id': vente.id}) }}" class="btn btn-success mr-2">PDF</a>#}

        {% if(vente.statusVente == 'progress') %}
            <a id="btnConfirm" href="{{ path('app_vente_confirm', {'id': vente.id}) }}" class="btn btn-success mr-2">Confirmer paiement</a>
            <a id="btnCancel" href="{{ path('app_vente_cancel', {'id': vente.id}) }}" class="btn btn-outline-danger">Annuler</a>
        {% else %}
            {% if is_granted('ROLE_ADMIN') %}
                {% if(vente.statusVente == 'paid') %}
                    <a id="btnCancel" href="{{ path('app_vente_cancel', {'id': vente.id}) }}" class="btn btn-outline-danger">Annuler</a>
                {% elseif(vente.statusVente != 'paid') %}
                    <a id="btnConfirm" href="{{ path('app_vente_confirm', {'id': vente.id}) }}" class="btn btn-success mr-2">Confirmerdd paiement</a>
                {% endif %}
            {% endif %}
        {% endif %}
    </div>
</div>
    <script src="{{ asset("assets/js/jquery.min.js") }}"></script>
    <script>
        $("#btnCancel").click(function(event) {
            if (confirm("Êtes-vous sûr(e) de vouloir Annuler la facture ?")) {
            } else {
                event.preventDefault();  // User clicked "Non" (No), prevent default behavior
            }
        });

        $("#btnConfirm").click(function(event) {
            if (confirm("Êtes-vous sûr(e) de vouloir Confirmer la facture ?")) {
            } else {
                event.preventDefault();  // User clicked "Non" (No), prevent default behavior
            }
        });
    </script>
{% endblock %}
